<section class="content-main">
  <form id="myForm">
    <div class="row">
      <div class="col-9">
        <div class="content-header">
          <h2 class="content-title">Edit Product</h2>

        </div>
      </div>
      <div class="col-lg-12">
        <div class="card mb-4">
          <div class="card-body">
            <div class="mb-4">
              <label for="productName" class="form-label">Product title</label>
              <input type="text" value="<%-  product.productName %>" class="form-control" id="productName"
                name="productName" required>
            </div>
            <div class="mb-4">
              <label class="form-label">Full description</label>
              <textarea class="form-control" rows="4" id="productDescription" name="productDescription"
                required><%- product.productDescription %></textarea>
            </div>
            <div class="row">
              <div class="col-lg-4">
                <div class="mb-4">
                  <label class="form-label">Regular price</label>
                  <div class="row gx-2">
                    <input value="<%- product.productPrice %>" type="text" class="form-control" id="productPrice"
                      name="productPrice" required>
                  </div>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="mb-4">
                  <label class="form-label">Old price</label>
                  <input placeholder="â‚¹" value="<%-  product.productOldPrice %> " type="text" class="form-control"
                    id="productOldPrice" name="productOldPrice" required>
                </div>
              </div>
              <div class="col-lg-4">
                <div class="mb-4">
                  <label class="form-label">Stocks</label>
                  <input value="<%-  product.stocks %> " type="text" class="form-control" id="stocks" name="stocks"
                    required>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="row gx-2">
                <div class="col-sm-6 mb-3">
                  <label class="form-label">Category</label>
                  <select class="form-select" name="productCategory" id="productCategory" required>
                    <option selected><%= categories[0].name %></option>
                    <% categories.forEach(category=> { %>
                      <% if(category.active) { %>
                        <option>
                          <%= category.name %>
                        </option>
                        <% } %>
                          <% }); %>
                  </select>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-12">
                <div class="card mb-4">
                  <div class="card-header">
                    <h4>Media</h4>
                  </div>
                  <div class="card-body">
                    <div class="row">
                      <% product.productImageUrls.forEach((imageUrl,index)=> { %>
                        <div class="col-sm mb-4 text-center">
                          <div class="image-preview" data-index="<%= index %>">
                            <img src="<%= imageUrl %>" alt="image">
                          </div>
                          <div class="">
                            <button type="button" class="btn btn-danger btn-sm delete-image-btn"
                              data-url="<%= imageUrl %>">Delete</button>
                            <label for="productImage" class="btn btn-primary colorChoose">Choose File</label>
                            <input class="form-control d-none" type="file" name="productImage" id="productImage">
                          </div>
                        </div>
                        <% }); %>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            <div>
              <button type="submit" id="add-product-btn" class="btn btn-md rounded font-sm hover-up">Update</button>
            </div>

          </div>
        </div>
      </div>
    </div>
  </form>
</section>
<style>
  input[type="file"] {
    display: none;
  }

  .colorChoose {
    background-color: rgb(8, 117, 250) !important;
  }
</style>


<script>

  function updateProduct(event) {
    event.preventDefault();

    const form = document.getElementById('myForm');
    const formData = new FormData(form);

    axios.put('/admin/edit-product', {
      data: {
        productId: product._id, // replace with the actual product ID
        ...Object.fromEntries(formData.entries())
      }
    })
      .then(response => {
        console.log(response.data);
        // do something after successful update, e.g. show a success message
      })
      .catch(error => {
        console.error(error.response.data);
        // handle the error, e.g. show an error message
      });
  }

  const updateBtn = document.getElementById('add-product-btn');
  updateBtn.addEventListener('click', updateProduct);


  //delete

  const deleteImageBtns = document.querySelectorAll('.delete-image-btn');

  deleteImageBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const imageUrl = btn.dataset.url;
      deleteImage(imageUrl);
    });
  });

  function deleteImage(imageUrl) {
    axios.put('/admin/edit-product', {
      data: {
        imageUrl: imageUrl
      }
    })
      .then(response => {
        console.log(response.data);
      })
      .catch(error => {
        console.error(error.response.data);
      });
  }

</script>














<!-- main -->
<!-- <div class="col-lg-3">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Media</h4>
            </div>
            <div class="card-body">
              <div class="input-upload">
                <img src="/admins/assets/imgs/theme/upload.svg" alt="">
                <input class="form-control" type="file" name="productImage" id="productImage" multiple required>
              </div>
            </div> -->
<!-- </div>
        </div> -->